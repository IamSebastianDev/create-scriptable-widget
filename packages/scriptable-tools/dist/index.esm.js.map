{"version":3,"file":"index.esm.js","sources":["../src/lib/fetch.mjs","../src/lib/remote.mjs"],"sourcesContent":["/** @format */\n\nconst handleOnRedirect = (method = 'follow', request) => {\n\tswitch (method) {\n\t\tcase 'follow':\n\t\t\treturn request;\n\t\tcase 'error':\n\t\t\tthrow new Error(\n\t\t\t\t`CWS-Fetch: The request was redirected. Aborting with error.`\n\t\t\t);\n\t\tcase 'manual':\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error(\n\t\t\t\t`CWS-Fetch: '${method} 'is not recognized as a valid redirect methid. Set method to 'follow', 'error' or 'manual'`\n\t\t\t);\n\t}\n};\n\n/**\n * A lightweight custom wrapper for the scriptable Request() method to more resemble the native fetch api.\n * Due to the limitations of the Request method, not all features are implemented.\n *\n * @param { string } resource the url the request should fetch from.\n * @param { {} } init - An object containing any custom settings that you want to apply to the request. The possible\n * options are:\n *  - method: The HTTP Method to use. Is 'GET' by default.\n *  - headers: Any headers to send with the request.\n *  - body: The request body.\n *  - redirect: What to do on redirect. Possible values are 'follow' to allow redirects, 'error' to abort with an error\n * and 'manual' to handle the redirect manually.\n *  - allowInsecureRequest: By default Scriptable will attempt to reject requests that are deemed insecure. Set to true\n * to overwrite.\n */\n\nexport const fetch = async (resource, init) =>\n\tnew Promise(async (resolve) => {\n\t\tconst req = new Request(resource);\n\t\treq.method = init.method || 'GET';\n\t\treq.headers = init.headers;\n\t\treq.body = init.body;\n\t\treq.redirect = handleOnRedirect.bind(null, init.redirect);\n\t\treq.allowInsecureRequest = init.allowInsecureRequest || false;\n\n\t\tconst response = await req.load();\n\t\tresolve(response);\n\t});\n","/** @format */\n\nimport { fetch } from './fetch.mjs';\n\nconst dispatch = async (receive) => {\n\t// check if the global hostname constant is set and return if it does not exist.\n\t// in theory, setting a own constant can be used to communicate with a custom server\n\t// if desired by the consumer.\n\n\tif (!HOSTNAME || typeof HOSTNAME !== 'string') {\n\t\treturn;\n\t}\n\n\tconst { type, data } = receive;\n\tif (data.optionalParams.length === 0) {\n\t\tdelete data.optionalParams;\n\t}\n\n\tconst payload = { type, data: !data.optionalParams ? data.message : data };\n\tconst address = 'http://' + HOSTNAME + '/socket';\n\tawait fetch(address, {\n\t\tmethod: 'POST',\n\t\theaders: { 'Content-type': 'application/json' },\n\t\tbody: JSON.stringify(payload),\n\t});\n};\n\nexport const remote = {\n\t/**\n\t * Method will log a message to the console, and dispatch the message to the development application. This method\n\t * will only work in the development enviroment. All passed values are passed through to the console.log method to\n\t * be logged by scriptable.\n\t *\n\t * @param {*} message primary message\n\t * @param  {...any} optionalParams substitution values\n\t */\n\n\tlog: (message, ...optionalParams) => {\n\t\tconsole.log(message, ...optionalParams);\n\t\tdispatch({ type: 'log', data: { message, optionalParams } });\n\t},\n\n\t/**\n\t * Method will log a warning to the console, and dispatch the warning to the development application. This method\n\t * will only work in the development enviroment. All passed values are passed through to the console.log method to\n\t * be logged by scriptable.\n\t *\n\t * @param {*} message primary message\n\t * @param  {...any} optionalParams substitution values\n\t */\n\n\twarn: (message, ...optionalParams) => {\n\t\tconsole.warn(message, ...optionalParams);\n\t\tdispatch({ type: 'warn', data: { message, optionalParams } });\n\t},\n\n\t/**\n\t * Method will log a error to the console, and dispatch the error to the development application. This method\n\t * will only work in the development enviroment. All passed values are passed through to the console.log method to\n\t * be logged by scriptable.\n\t *\n\t * @param {*} message primary message\n\t * @param  {...any} optionalParams substitution values\n\t */\n\n\terror: (message, ...optionalParams) => {\n\t\tconsole.error(message, ...optionalParams);\n\t\tdispatch({ type: 'error', data: { message, optionalParams } });\n\t},\n};\n"],"names":[],"mappings":"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"}